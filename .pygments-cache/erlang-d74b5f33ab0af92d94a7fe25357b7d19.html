<div class="highlight"><pre><span class="nf">tallier</span><span class="p">(</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="nv">Workers</span><span class="p">,</span> <span class="nv">X</span><span class="p">,</span> <span class="nv">AssignFinished</span><span class="p">)</span> <span class="o">-&gt;</span>

    <span class="k">receive</span>
        <span class="p">{</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="n">true</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="c">%% This message is from the solver</span>
            <span class="c">%% It tells the tallier that</span>
            <span class="c">%% worker assignment has finished</span>
            <span class="n">tallier</span><span class="p">(</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="nv">Workers</span><span class="p">,</span> <span class="nv">X</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
        <span class="p">{</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="nv">WorkerPid</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="c">%% This message is from the solver</span>
            <span class="c">%% Register WorkerPid</span>
            <span class="n">tallier</span><span class="p">(</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="p">[</span><span class="nv">WorkerPid</span> <span class="p">|</span> <span class="nv">Workers</span><span class="p">],</span> <span class="nv">X</span><span class="p">,</span> <span class="nv">AssignFinished</span><span class="p">);</span>
        <span class="p">{</span><span class="nv">WorkerPid</span><span class="p">,</span> <span class="nv">Sum</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="nv">Tally</span> <span class="o">=</span> <span class="nv">X</span> <span class="o">+</span> <span class="nv">Sum</span><span class="p">,</span>
            <span class="c">%% Remove worker from Workers list</span>
            <span class="nv">NewWorkerList</span> <span class="o">=</span> <span class="nv">Workers</span> <span class="o">--</span> <span class="p">[</span><span class="nv">WorkerPid</span><span class="p">],</span>
            <span class="k">case</span> <span class="nv">AssignFinished</span> <span class="k">of</span>
                <span class="n">true</span> <span class="o">-&gt;</span>
                    <span class="k">case</span> <span class="nv">NewWorkerList</span> <span class="k">of</span>
                        <span class="p">[]</span> <span class="o">-&gt;</span>
                            <span class="nv">SolverPid</span> <span class="o">!</span> <span class="p">{</span> <span class="n">self</span><span class="p">(),</span> <span class="nv">Tally</span> <span class="p">};</span>
                        <span class="p">_</span> <span class="o">-&gt;</span> <span class="n">tallier</span><span class="p">(</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="nv">NewWorkerList</span><span class="p">,</span> <span class="nv">Tally</span><span class="p">,</span> <span class="nv">AssignFinished</span><span class="p">)</span>
                    <span class="k">end</span><span class="p">;</span>
                <span class="p">_</span> <span class="o">-&gt;</span> <span class="n">tallier</span><span class="p">(</span><span class="nv">SolverPid</span><span class="p">,</span> <span class="nv">NewWorkerList</span><span class="p">,</span> <span class="nv">Tally</span><span class="p">,</span> <span class="nv">AssignFinished</span><span class="p">)</span>
            <span class="k">end</span>
    <span class="k">end</span><span class="p">.</span>
</pre></div>