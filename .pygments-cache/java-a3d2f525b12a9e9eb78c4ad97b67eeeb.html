<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckRateHandler</span> <span class="kd">implements</span> <span class="n">ActionHandler</span><span class="o">&lt;</span><span class="n">CheckRate</span><span class="o">,</span> <span class="n">CheckRateResult</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">URL_BUY</span> <span class="o">=</span> <span class="s">&quot;http://www.ingdirect.ca/en/datafiles/rates/usbuying.html&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">URL_SELL</span> <span class="o">=</span> <span class="s">&quot;http://www.ingdirect.ca/en/datafiles/rates/usselling.html&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CheckRateHandler</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">CheckRateResult</span> <span class="nf">execute</span><span class="o">(</span><span class="kd">final</span> <span class="n">CheckRate</span> <span class="n">action</span><span class="o">,</span> <span class="kd">final</span> <span class="n">ExecutionContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ActionException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">CheckRateResult</span> <span class="n">retval</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckRateResult</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">strUrl</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">getType</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nl">Buying:</span>
            <span class="n">strUrl</span> <span class="o">=</span> <span class="n">URL_BUY</span><span class="o">;</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="nl">Selling:</span>
            <span class="n">strUrl</span> <span class="o">=</span> <span class="n">URL_SELL</span><span class="o">;</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">strUrl</span><span class="o">);</span>

            <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">()));</span>

                <span class="kd">final</span> <span class="kt">double</span> <span class="n">dRate</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span>

                <span class="kd">final</span> <span class="n">Rate</span> <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rate</span><span class="o">();</span>
                <span class="n">rate</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="n">dRate</span><span class="o">);</span>
                <span class="n">rate</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
                <span class="n">rate</span><span class="o">.</span><span class="na">setTimeFetched</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>

                <span class="n">retval</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="n">rate</span><span class="o">);</span>

            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">br</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                    <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ActionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ActionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ActionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">retval</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// ... other methods omitted</span>
<span class="o">}</span>
</pre></div>